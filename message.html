<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeChat Clone</title>
    <style>
        :root {
            --wechat-bg: #f3f3f3;
            --wechat-green: #95ec69;
            --wechat-white: #ffffff;
            --wechat-text: #191919;
            --wechat-gray: #b2b2b2;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--wechat-bg);
        }

        /* 聊天主容器 */
        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 500px;
            margin: 0 auto;
            border: 1px solid #ddd;
            position: relative;
        }

        /* 標題欄 */
        header {
            background-color: var(--wechat-bg);
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #e0e0e0;
        }

        /* 訊息顯示區 */
        #chat-window {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* 訊息氣泡通用樣式 */
        .message {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 6px;
            position: relative;
            word-wrap: break-word;
            font-size: 16px;
            cursor: pointer;
            user-select: none; /* 防止長按時選取文字 */
            -webkit-touch-callout: none; /* 禁用系統預設長按選單 */
        }

        /* 右側訊息 (本人) */
        .msg-right {
            align-self: flex-end;
            background-color: var(--wechat-green);
            color: var(--wechat-text);
        }
        .msg-right::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 10px;
            border-left: 8px solid var(--wechat-green);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        /* 左側訊息 (對方) */
        .msg-left {
            align-self: flex-start;
            background-color: var(--wechat-white);
            color: var(--wechat-text);
        }
        .msg-left::after {
            content: '';
            position: absolute;
            left: -6px;
            top: 10px;
            border-right: 8px solid var(--wechat-white);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        /* 輸入框區塊 */
        footer {
            background-color: #f7f7f7;
            padding: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-top: 1px solid #e0e0e0;
        }

        #input-msg {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            outline: none;
            font-size: 16px;
        }

        #send-btn {
            background-color: #07c160;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* 自定義彈出選單 */
        #context-menu {
            position: fixed;
            background: #4c4c4c;
            color: white;
            border-radius: 8px;
            display: none;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        #context-menu div {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            border-bottom: 1px solid #5a5a5a;
        }

        #context-menu div:last-child {
            border-bottom: none;
        }

        #context-menu div:hover {
            background: #5a5a5a;
        }

        /* 遮罩層（點擊外部關閉選單） */
        #overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            z-index: 999;
        }
    </style>
</head>
<body>

<div id="app">
    <header>單機微信</header>
    <div id="chat-window">
        </div>
    <footer>
        <input type="text" id="input-msg" placeholder="輸入訊息..." autocomplete="off">
        <button id="send-btn">發送</button>
    </footer>
</div>

<div id="overlay"></div>
<div id="context-menu">
    <div onclick="editMessage()">編輯</div>
    <div onclick="moveMessage()">移動發信人</div>
</div>

<script>
    const chatWindow = document.getElementById('chat-window');
    const inputMsg = document.getElementById('input-msg');
    const sendBtn = document.getElementById('send-btn');
    const contextMenu = document.getElementById('context-menu');
    const overlay = document.getElementById('overlay');

    let currentMsgElement = null; // 當前長按操作的訊息
    let pressTimer; // 用於判斷長按的計時器

    // 發送訊息
    function sendMessage() {
        const text = inputMsg.value.trim();
        if (text === "") return;

        const msgDiv = document.createElement('div');
        msgDiv.className = 'message msg-right';
        msgDiv.innerText = text;

        // 綁定長按與滑鼠事件
        msgDiv.onmousedown = (e) => startPress(e, msgDiv);
        msgDiv.ontouchstart = (e) => startPress(e, msgDiv);
        msgDiv.onmouseup = clearPress;
        msgDiv.ontouchend = clearPress;

        chatWindow.appendChild(msgDiv);
        inputMsg.value = "";
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    sendBtn.onclick = sendMessage;
    inputMsg.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };

    // 長按邏輯
    function startPress(e, element) {
        currentMsgElement = element;
        pressTimer = setTimeout(() => {
            showMenu(e);
        }, 600); // 600毫秒判定為長按
    }

    function clearPress() {
        clearTimeout(pressTimer);
    }

    // 顯示選單
    function showMenu(e) {
        e.preventDefault();
        const touch = e.touches ? e.touches[0] : e;
        contextMenu.style.left = touch.clientX + 'px';
        contextMenu.style.top = touch.clientY + 'px';
        contextMenu.style.display = 'flex';
        overlay.style.display = 'block';
    }

    // 關閉選單
    overlay.onclick = () => {
        contextMenu.style.display = 'none';
        overlay.style.display = 'none';
    };

    // 功能 1：編輯訊息
    function editMessage() {
        const oldText = currentMsgElement.innerText;
        const newText = prompt("編輯訊息：", oldText);
        if (newText !== null && newText.trim() !== "") {
            currentMsgElement.innerText = newText;
        }
        overlay.onclick(); // 關閉選單
    }

    // 功能 2：移動發信人
    function moveMessage() {
        if (currentMsgElement.classList.contains('msg-right')) {
            currentMsgElement.classList.remove('msg-right');
            currentMsgElement.classList.add('msg-left');
        } else {
            currentMsgElement.classList.remove('msg-left');
            currentMsgElement.classList.add('msg-right');
        }
        overlay.onclick(); // 關閉選單
    }
</script>

</body>
</html>
